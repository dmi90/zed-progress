<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Distance covered by Zed during the 2nd Cycleathon</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background: #2f3640;
            color: white;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        canvas {
            width: 100vw;
            height: 100vh;
        }

        h2 {
            color: white;
            position: absolute;
            top: 2rem;
            font-size: 2.5rem;
            text-align: center;
            width: 100%;
            z-index: 2;
        }
    </style>
</head>
<body>
<h2>Distance covered by Zed during the 2nd Cycleathon</h2>
<canvas id="kmChart"></canvas>

<script>
    const labels = [
        "Ljubljana", "Day 1: Trieste", "Day 2: Udine", "Day 3: Venice", "Day 4: Padova", "Day 5: Ferrara",
        "Day 6: Bologna, Ravenna", "Day 7: Rimini", "Day 8: San Marino, Ancona", "Day 9: Pescara", 
        "Day 10: L'Aquila", "Day 11: Róma", "Day 12: ??? - Grossetto"
    ];

    const actual = [
        0, 100.2, 181.1, 317.8, 362, 443.9, 601.8, 670.7, 818, 974.3, 1082.7, 1230.1, 1396.1
    ];

    const goal = [
        0, 179.4, 265.3, 476.4, 503.1, 583.5, 802, 930.6, 1000.1, 1117.7, 1227.1, 1297.8, 1477.4
    ];

    const difference = goal.map((g, i) => g - actual[i]);

    const ctx = document.getElementById('kmChart').getContext('2d');

    const data = {
        labels: [],
        datasets: [
            {
                label: 'Distance Covered (km)',
                data: [],
                borderColor: 'rgba(255, 20, 147, 1)',
                backgroundColor: 'rgba(255, 20, 147, 0.2)',
                fill: false,
                tension: 0.4
            },
            {
                label: 'Goal Distance (km)',
                data: [],
                borderColor: 'rgba(0, 255, 255, 1)',
                backgroundColor: 'rgba(0, 255, 255, 0.2)',
                fill: false,
                tension: 0.4
            },
            {
                label: 'Distance left (km)',
                data: [],
                borderColor: 'lime',
                backgroundColor: 'rgba(0, 255, 0, 0.2)',
                fill: false,
                tension: 0.4
            }
        ]
    };

    const config = {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            animation: false,
            scales: {
                y: {
                    beginAtZero: true,
                    min: 0,
                    max: (Math.round((goal[goal.length - 1] + 200) / 100) * 100), /* (tudom ez undorítóan néz ki) */
                    ticks: {
                        callback: function(value) {
                            return value.toFixed(1); // 1 decimal place
                        },
                        color: 'white'
                    },
                    title: {
                        display: true,
                        text: 'Kilometers',
                        color: 'white'
                    },
                    grid: {
                        display: false
                    }
                },
                x: {
                    ticks: {
                        autoSkip: false,
                        color: 'white'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: 'white'
                    }
                },
                title: {
                    display: true,
                    text: 'Distance covered by Zed during the 2nd Cycleathon',
                    color: 'white',
                    padding: {
                        top: 20
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: ${context.raw.toFixed(1)} km`;
                        }
                    }
                }
            }
        }
    };

    const kmChart = new Chart(ctx, config);

    let frame = 0;
    const totalFrames = labels.length * 50;

    const interpolatedActual = [];
    const interpolatedGoal = [];
    const interpolatedDifference = [];
    const interpolatedLabels = [];

    const stepsPerSegment = Math.floor(totalFrames / (actual.length - 1));

    for (let i = 0; i < actual.length - 1; i++) {
        for (let j = 0; j < stepsPerSegment; j++) {
            const t = j / stepsPerSegment;
            interpolatedActual.push(actual[i] + (actual[i + 1] - actual[i]) * t);
            interpolatedGoal.push(goal[i] + (goal[i + 1] - goal[i]) * t);
            interpolatedDifference.push(
                (goal[i] - actual[i]) + ((goal[i + 1] - actual[i + 1]) - (goal[i] - actual[i])) * t
            );
            interpolatedLabels.push(j === stepsPerSegment - 1 ? labels[i + 1] : "");
        }
    }

    interpolatedActual.push(actual[actual.length - 1]);
    interpolatedGoal.push(goal[goal.length - 1]);
    interpolatedDifference.push(difference[difference.length - 1]);
    interpolatedLabels.push('');

    function animateChart() {
        if (frame < interpolatedActual.length) {
            data.datasets[0].data.push(interpolatedActual[frame]);
            data.datasets[1].data.push(interpolatedGoal[frame]);
            data.datasets[2].data.push(interpolatedDifference[frame]);
            data.labels.push(interpolatedLabels[frame]);
            kmChart.update();
            frame++;
            requestAnimationFrame(animateChart);
        }
    }

    animateChart();
</script>

</body>
</html>
